{
  "kind": "build_request",
  "title": "Add GPS-based nearby salon discovery with location management",
  "projectName": "Baitoo",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-33",
      "text": "Extend the backend Salon type to include optional latitude (Float) and longitude (Float) fields for storing GPS coordinates",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Store: Salon Name, Full Address, Latitude, Longitude"
        ]
      },
      "acceptanceCriteria": [
        "Salon type includes optional latitude and longitude fields",
        "Existing salons without coordinates remain functional"
      ]
    },
    {
      "id": "REQ-34",
      "text": "Add backend function updateSalonLocation that allows admin users to update a salon's latitude and longitude coordinates by salon ID",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Admin should be able to upload and save salon location easily"
        ]
      },
      "acceptanceCriteria": [
        "Function accepts salon ID, latitude, and longitude as parameters",
        "Only admin users can call this function",
        "Function updates the salon record with the provided coordinates",
        "Returns success or error result"
      ]
    },
    {
      "id": "REQ-35",
      "text": "Add location input fields (latitude and longitude) to the AdminDashboard for each salon with a save button to update salon coordinates",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Add location field for each salon in admin panel",
          "Admin should be able to upload and save salon location easily"
        ]
      },
      "acceptanceCriteria": [
        "Admin panel displays latitude and longitude input fields for each salon",
        "Input fields show current coordinates if already set",
        "Save button calls updateSalonLocation backend function",
        "Success/error feedback is displayed after save attempt"
      ]
    },
    {
      "id": "REQ-36",
      "text": "Implement GPS location permission request flow in SalonDiscoveryPage that asks for user's current location when the page loads",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Ask customer permission to access current GPS location"
        ]
      },
      "acceptanceCriteria": [
        "Browser geolocation API permission is requested on page load",
        "Permission state (granted/denied) is tracked",
        "User's latitude and longitude are retrieved if permission is granted"
      ]
    },
    {
      "id": "REQ-37",
      "text": "Add distance calculation utility function that computes the distance in kilometers between two GPS coordinates using the Haversine formula",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Calculate distance between customer and salons using latitude and longitude",
          "Show distance in kilometers (example: \"1.5 km away\")"
        ]
      },
      "acceptanceCriteria": [
        "Function accepts two coordinate pairs (lat1, lon1, lat2, lon2)",
        "Returns distance in kilometers with one decimal place precision",
        "Handles edge cases (same location returns 0 km)"
      ]
    },
    {
      "id": "REQ-38",
      "text": "Update SalonDiscoveryPage to calculate and display distance from customer's current location to each salon that has GPS coordinates, showing the distance in the format '1.5 km away'",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Show distance in kilometers (example: \"1.5 km away\")"
        ]
      },
      "acceptanceCriteria": [
        "Distance is displayed next to each salon that has coordinates",
        "Distance format matches '1.5 km away' pattern",
        "Salons without coordinates do not show distance"
      ]
    },
    {
      "id": "REQ-39",
      "text": "Update SalonDiscoveryPage to sort salons by distance from customer's location, placing nearest salons first when location permission is granted",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Sort salons by nearest first",
          "Only nearby salons should appear on top"
        ]
      },
      "acceptanceCriteria": [
        "When location permission is granted, salons are sorted by ascending distance",
        "Salons without coordinates appear after salons with coordinates",
        "When location permission is denied, original salon order is preserved"
      ]
    },
    {
      "id": "REQ-40",
      "text": "Update SalonDiscoveryPage heading text to dynamically display 'Nearby You' when location permission is granted, or 'Salons in Faizabad' when permission is denied or not available",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Replace static text \"Salon in Faizabad\"",
          "If location permission is allowed → show heading: \"Nearby You\"",
          "If location permission is denied → show default city salons"
        ]
      },
      "acceptanceCriteria": [
        "Heading displays 'Nearby You' when GPS permission is granted",
        "Heading displays 'Salons in Faizabad' when GPS permission is denied or unavailable",
        "Heading updates immediately after permission state changes"
      ]
    },
    {
      "id": "REQ-41",
      "text": "Add a notice text 'Please reach the salon at least 10 minutes before your booking time.' below the booking confirmation button on the BookingPage",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "On customer booking page, below booking button add: \"Please reach the salon at least 10 minutes before your booking time.\""
        ]
      },
      "acceptanceCriteria": [
        "Notice text appears directly below the booking button",
        "Text is clearly visible and styled appropriately",
        "Text reads exactly: 'Please reach the salon at least 10 minutes before your booking time.'"
      ]
    }
  ],
  "constraints": [
    "Respect single-actor backend architecture and keep all logic in main.mo",
    "Do not modify immutable frontend paths: useInternetIdentity, useActor, main.tsx, and ui components",
    "Use React Query for state management and data fetching",
    "Maintain existing authentication and authorization patterns"
  ],
  "nonGoals": [
    "Real-time location tracking or continuous GPS monitoring",
    "Map visualization or interactive maps",
    "Geocoding service integration to convert addresses to coordinates",
    "Automatic salon location detection",
    "Distance-based filtering or radius search"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}